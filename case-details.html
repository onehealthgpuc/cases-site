<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Case Detail</title>
<style>
body { font-family: system-ui, Arial, sans-serif; margin:0; background:#f6f6f6; }
header { display:flex; justify-content:space-between; align-items:center; padding:10px 20px; background:#fff; border-bottom:1px solid #ccc; }
header h1 { margin:0; font-size:1.2em; }
header button { padding:6px 10px; border:none; background:#0d6efd; color:#fff; border-radius:6px; cursor:pointer; }
header button:hover { background:#0b5ed7; }

#caseDetail { max-width:800px; margin:20px auto; background:#fff; padding:20px; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
#caseDetail h2 { margin-top:0; }
#caseDetail p { line-height:1.4; }
#caseDetail img { max-width:100%; margin:10px 0; border-radius:6px; }
#caseDetail a.pdf-link { display:inline-block; margin:10px 0; color:#0d6efd; text-decoration:none; font-weight:600; }
#caseDetail a.pdf-link:hover { text-decoration:underline; }
</style>
</head>
<body>

<header>
  <h1>Case Detail</h1>
  <button onclick="goBack()">Back</button>
</header>

<div id="caseDetail">
  <p>Loading case...</p>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
import { getStorage, ref, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics.js";

// ---------- Firebase Setup ----------
const firebaseConfig = {
  apiKey: "AIzaSyD3e8G3s9Hwk5Kf6Ay3L58RTjyAkL-xr4I",
  authDomain: "medical-cases-c4809.firebaseapp.com",
  projectId: "medical-cases-c4809",
  storageBucket: "medical-cases-c4809.appspot.com",
  messagingSenderId: "591206005422",
  appId: "1:591206005422:web:7834dc84e5eebd4b4b8b3f",
  measurementId: "G-B6P6BG0D9K"
};

const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const db = getFirestore(app);
const storage = getStorage(app);

// ---------- DOM ----------
const detailDiv = document.getElementById('caseDetail');

// ---------- Get Case ----------
const caseId = localStorage.getItem('selectedCaseId');
if(!caseId){
  detailDiv.innerHTML = "<p>No case selected.</p>";
} else {
  (async ()=>{
    try {
      const caseDoc = await getDoc(doc(db,'cases',caseId));
      if(!caseDoc.exists()){
        detailDiv.innerHTML = "<p>Case not found.</p>";
        return;
      }

      const data = caseDoc.data();
      detailDiv.innerHTML = `
        <h2>${data.title}</h2>
        <p><strong>Uploaded:</strong> ${new Date(data.timestamp).toLocaleString()}</p>
        <p>${data.notes || ""}</p>
      `;

      // Add PDF link if exists
      if(data.pdfURL){
        const pdfLink = document.createElement('a');
        pdfLink.href = data.pdfURL;
        pdfLink.target = "_blank";
        pdfLink.textContent = "View PDF";
        pdfLink.className = "pdf-link";
        detailDiv.appendChild(pdfLink);
      }

      // Add image if exists
      if(data.imgURL){
        const img = document.createElement('img');
        img.src = data.imgURL;
        detailDiv.appendChild(img);
      }

    } catch(err){
      console.error(err);
      detailDiv.innerHTML = "<p>Failed to load case: "+err.message+"</p>";
    }
  })();
}

// ---------- Back Button ----------
function goBack(){
  location.href = 'cases.html';
}
</script>
</body>
</html>
